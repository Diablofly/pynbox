#!/bin/bash

BIN_DIR="$(dirname $BASH_SOURCE[0])"
RUN_DIR="$(dirname $BIN_DIR)"

# If no -l or -v option is specified for sel_ldr, silence the log by default.
SILENCE_LOG="-l /dev/null"

# Scan options recognized by sel_ldr (we only need to list those that take an
# argument).
while getopts ":h:r:w:i:f:l:m:E:v" opt; do
  case "$opt" in
    l|v) SILENCE_LOG="";;
  esac
done

SEL_LDR_FLAGS=${@:1:$((OPTIND-1))}
ARGS=("${@:$OPTIND}")

# Change to the directory of the script, which should be the build directory.
cd "$RUN_DIR"
exec bin/sel_ldr -m root -B lib/irt_core.nexe $SEL_LDR_FLAGS $SILENCE_LOG lib/runnable-ld.so --library-path /slib "${ARGS[@]}"
